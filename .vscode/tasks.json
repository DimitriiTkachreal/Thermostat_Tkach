{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "build: firmware",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/Software/core"
            },
            // --- ГОЛОВНА ЗМІНА ---
            // Ми використовуємо ";" замість "&&", щоб PowerShell не сварився.
            // 1. Компіляція (cxstm8)
            // 2. Лінковка (clnk) -> створює main.sm8
            // 3. Конвертація (chex) -> створює firmware.s19
            "command": "cxstm8 -i\"../../platform/cosmic_headers\" +mods0 main.c ; clnk -o main.sm8 Linker.lkf ; chex -o \"../build/firmware.s19\" main.sm8",
            
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": []
        },

        // --- ЗАДАЧА ПРОШИВКИ (STVP) ---
        {
            "label": "flash: stvp",
            "type": "process",
            "command": "C:\\Program Files (x86)\\STMicroelectronics\\st_toolset\\stvp\\STVP_CmdLine.exe",
            "args": [
                "-BoardName=ST-LINK",
                "-Port=USB",
                "-ProgMode=SWIM",
                "-Device=STM8S103F3",
                "-no_loop",
                "-no_log",
                "-verif",
                "-FileProg=${workspaceFolder}\\Software\\build\\firmware.s19"
            ],
            "dependsOn": "build: firmware",
            "problemMatcher": []
        },

        // --- ОЧИСТКА ---
        {
            "label": "clean: build",
            "type": "shell",
            "command": "del \"Software\\build\\*.*\" /q ; del \"Software\\core\\*.o\" /q ; del \"Software\\core\\*.sm8\" /q",
            "problemMatcher": []
        }
    ]
}